<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>InterestNexus - æ¯•ä¸šè®¾è®¡æœ€ç»ˆç‰ˆ</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vant/lib/vant.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/vant/lib/index.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <style>
        :root {
            --bg-color: #09090b;
            --card-bg: rgba(30, 30, 40, 0.6);
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --text-main: #ffffff;
            --text-sub: #b2bec3;
            --highlight: #f1c40f;
        }

        body {
            margin: 0;
            background-color: var(--bg-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            color: var(--text-main);
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* èƒŒæ™¯ */
        #canvas-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at center, #1e1e2f 0%, #000000 100%);
        }

        /* å¸ƒå±€ */
        .app-layout {
            height: 100vh; display: flex; flex-direction: column; overflow-y: scroll;
            padding-bottom: 90px; scroll-behavior: smooth;
        }

        /* é€šç”¨å¡ç‰‡ */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .page-title {
            font-size: 24px; font-weight: 800; margin: 20px 16px 10px;
            background: linear-gradient(to right, #fff, #a29bfe);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* ç‰©å“æµ·æŠ¥ç½‘æ ¼ (é¦–é¡µ) */
        .media-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 0 16px;
        }
        .media-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            aspect-ratio: 2/3;
        }
        .media-item img { width: 100%; height: 100%; object-fit: cover; }
        .media-info {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 10px; box-sizing: border-box;
        }

        /* å›¾è°±é¡µæ¨èåˆ—è¡¨ */
        .match-card {
            display: flex; align-items: center;
            background: rgba(255,255,255,0.05);
            border-radius: 12px; padding: 12px; margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s;
        }
        .match-card.active {
            border-color: #a29bfe;
            background: rgba(162, 155, 254, 0.1);
        }

        /* åº•éƒ¨å¯¼èˆª */
        .floating-tabbar {
            position: fixed; bottom: 20px; left: 5%; width: 90%; height: 65px;
            background: rgba(20, 20, 30, 0.85); backdrop-filter: blur(20px);
            border-radius: 35px; display: flex; justify-content: space-around; align-items: center;
            border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.5); z-index: 100;
        }
        .tab-item {
            display: flex; flex-direction: column; align-items: center; color: #636e72;
            transition: all 0.3s ease;
        }
        .tab-item.active { color: #a29bfe; transform: translateY(-5px); }
        .tab-item i { font-size: 24px; margin-bottom: 2px; }
        .tab-item span { font-size: 10px; font-weight: 500; }

        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        
        /* æ ‡ç­¾æ ·å¼ */
        .tag { padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-right: 4px; }
        .tag-movie { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }
        .tag-book { background: rgba(46, 204, 113, 0.2); color: #2ecc71; }
        .tag-music { background: rgba(52, 152, 219, 0.2); color: #3498db; }
    </style>
</head>
<body>

<div id="canvas-bg"></div>

<div id="app">
    <div class="app-layout">
        
        <transition name="fade">
            <div v-if="activeTab === 0" key="explore">
                <div class="page-title">æ¢ç´¢ / Discovery</div>
                <van-search v-model="searchVal" placeholder="æœç´¢ä¹¦ç±/ç”µå½±/éŸ³ä¹..." shape="round" background="transparent"></van-search>
                
                <div style="padding: 0 16px; margin-bottom: 10px;">
                    <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                        <span style="font-weight:bold; font-size:16px;">ğŸ“š çŒœä½ å–œæ¬¢</span>
                        <span style="font-size:12px; color:var(--text-sub);">åŸºäºååŒè¿‡æ»¤</span>
                    </div>
                </div>

                <div class="media-grid">
                    <div v-for="item in items" :key="item.id" class="media-item">
                        <img :src="item.cover">
                        <div class="media-info">
                            <div style="display:flex; margin-bottom:4px;">
                                <span class="tag" :class="item.tagClass">{{ item.type }}</span>
                                <span style="font-size:12px; color:#f1c40f"><i class="ri-star-fill"></i> {{ item.score }}</span>
                            </div>
                            <div style="font-weight:bold; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">{{ item.title }}</div>
                        </div>
                    </div>
                </div>
                
                <div style="text-align:center; padding: 20px; color:var(--text-sub); font-size:12px;">
                    - åˆ°åº•äº†ï¼Œå»æ ‡è®°æ›´å¤šå…´è¶£å§ -
                </div>
            </div>
        </transition>

        <transition name="fade">
            <div v-if="activeTab === 1" key="groups">
                <div class="page-title">åœˆå­ / Communities</div>
                <div style="padding: 0 16px;">
                    <div class="glass-card" v-for="g in groups" :key="g.id" style="display:flex; align-items:center;">
                        <img :src="g.img" style="width:50px; height:50px; border-radius:12px; object-fit:cover;">
                        <div style="margin-left:12px; flex:1;">
                            <div style="font-weight:bold;">{{ g.name }}</div>
                            <div style="font-size:12px; color:var(--text-sub);">{{ g.desc }}</div>
                        </div>
                        <van-button size="mini" plain color="#a29bfe">åŠ å…¥</van-button>
                    </div>
                </div>
            </div>
        </transition>

        <transition name="fade">
            <div v-if="activeTab === 2" key="graph">
                <div class="page-title">å›¾è°± / Nexus</div>
                
                <div style="padding: 0 16px;">
                    <div class="glass-card" style="padding:0; overflow:hidden; position:relative;">
                        <div id="nexus-chart" style="width:100%; height:350px;"></div>
                        <div style="position:absolute; top:10px; left:10px; font-size:10px; color:rgba(255,255,255,0.6); pointer-events:none;">
                            ç‚¹å‡»ä¸‹æ–¹åˆ—è¡¨æŸ¥çœ‹å…³è”è·¯å¾„
                        </div>
                    </div>
                </div>

                <div style="padding: 0 16px;">
                    <div style="margin-bottom:12px; font-weight:bold;">âœ¨ çµé­‚å…±é¸£ (æ¨èå¥½å‹)</div>
                    
                    <div 
                        v-for="user in recommendedUsers" 
                        :key="user.id" 
                        class="match-card"
                        :class="{ active: selectedUserId === user.id }"
                        @click="focusUser(user)"
                    >
                        <div style="position:relative;">
                            <img :src="user.avatar" style="width:48px; height:48px; border-radius:50%;">
                            <div style="position:absolute; -5px; right:-5px; background:#fab1a0; color:#d63031; font-size:9px; padding:1px 4px; border-radius:4px; font-weight:bold;">
                                {{ user.match }}%
                            </div>
                        </div>
                        <div style="margin-left:12px; flex:1;">
                            <div style="font-weight:bold; font-size:15px;">{{ user.name }}</div>
                            <div style="font-size:11px; color:var(--text-sub); margin-top:4px;">
                                <i class="ri-link"></i> æ¨èç†ç”±ï¼šå…±åŒå–œæ¬¢ 
                                <span style="color:#a29bfe; font-weight:bold;">{{ user.reason }}</span>
                            </div>
                        </div>
                        <van-icon name="arrow" color="#666" />
                    </div>
                </div>
            </div>
        </transition>

        <transition name="fade">
            <div v-if="activeTab === 3" key="profile">
                <div style="padding: 0 16px; padding-top: 40px;">
                    <div style="display:flex; align-items:center;">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" style="width:70px; height:70px; border-radius:50%; border:2px solid white;">
                        <div style="margin-left:16px;">
                            <div style="font-size:20px; font-weight:bold;">æ¢é‡‘éº¦</div>
                            <div style="font-size:12px; color:var(--text-sub);">22çº§è®¡ç§‘2ç­</div>
                        </div>
                    </div>
                    <div class="glass-card" style="margin-top:20px;">
                        <van-cell title="æˆ‘æ ‡è®°çš„ä¹¦å½±éŸ³" is-link style="background:transparent; color:white;"></van-cell>
                        <van-cell title="æˆ‘çš„å›¾è°±æ•°æ®" is-link style="background:transparent; color:white;"></van-cell>
                    </div>
                </div>
            </div>
        </transition>

    </div>

    <div class="floating-tabbar">
        <div class="tab-item" :class="{ active: activeTab === 0 }" @click="activeTab = 0">
            <i class="ri-compass-3-line"></i><span>å‘ç°</span>
        </div>
        <div class="tab-item" :class="{ active: activeTab === 1 }" @click="activeTab = 1">
            <i class="ri-group-line"></i><span>å°ç»„</span>
        </div>
        <div class="tab-item" :class="{ active: activeTab === 2 }" @click="activeTab = 2">
            <i class="ri-mind-map"></i><span>å›¾è°±</span>
        </div>
        <div class="tab-item" :class="{ active: activeTab === 3 }" @click="activeTab = 3">
            <i class="ri-user-smile-line"></i><span>æˆ‘çš„</span>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, onMounted, nextTick, watch } = Vue;

    createApp({
        setup() {
            const activeTab = ref(0);
            const searchVal = ref('');
            const selectedUserId = ref(null); // å½“å‰é€‰ä¸­çš„æ¨èç”¨æˆ·
            
            // 1. é¦–é¡µæ¨èæ•°æ®ï¼šçº¯ç²¹çš„ç‰©å“ï¼ˆä¹¦/å½±/éŸ³ï¼‰
            const items = ref([
                { id: 1, title: 'å¥¥æœ¬æµ·é»˜', type: 'ç”µå½±', score: 9.2, tagClass: 'tag-movie', cover: 'https://images.unsplash.com/photo-1536440136628-849c177e76a1?w=400&q=80' },
                { id: 2, title: 'ä¸‰ä½“å…¨é›†', type: 'ä¹¦ç±', score: 9.5, tagClass: 'tag-book', cover: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=400&q=80' },
                { id: 3, title: 'Dark Side of the Moon', type: 'éŸ³ä¹', score: 9.7, tagClass: 'tag-music', cover: 'https://images.unsplash.com/photo-1493225255756-d9584f8606e9?w=400&q=80' },
                { id: 4, title: 'èµ›åšæœ‹å…‹:è¾¹ç¼˜è¡Œè€…', type: 'ç”µå½±', score: 9.0, tagClass: 'tag-movie', cover: 'https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?w=400&q=80' },
                { id: 5, title: 'Vue.jsè®¾è®¡ä¸å®ç°', type: 'ä¹¦ç±', score: 9.8, tagClass: 'tag-book', cover: 'https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=400&q=80' },
                { id: 6, title: 'Interstellar', type: 'éŸ³ä¹', score: 9.6, tagClass: 'tag-music', cover: 'https://images.unsplash.com/photo-1459749411177-0473ef71607b?w=400&q=80' },
            ]);

            // 2. å…´è¶£å°ç»„æ•°æ®
            const groups = ref([
                { id: 1, name: 'ç§‘å¹»è¿·èˆª', desc: 'ç¡¬ç§‘å¹»çˆ±å¥½è€…èšé›†åœ°', img: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=200&q=80' },
                { id: 2, name: 'ç‹¬ç«‹å¼€å‘', desc: 'Vue/ReactæŠ€æœ¯äº¤æµ', img: 'https://images.unsplash.com/photo-1552820728-8b83bb6b773f?w=200&q=80' }
            ]);

            // 3. å›¾è°±é¡µï¼šæ¨èå¥½å‹ + æ¨èç†ç”±
            const recommendedUsers = ref([
                { id: '101', name: 'Alice', match: 98, reason: 'ã€Šä¸‰ä½“ã€‹', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Alice' },
                { id: '102', name: 'Bob', match: 92, reason: 'ã€ŠVue.jsè®¾è®¡ã€‹', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Bob' },
                { id: '103', name: 'Carol', match: 85, reason: 'Pink Floyd', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Carol' }
            ]);

            // Three.js èƒŒæ™¯ï¼ˆç®€åŒ–ç‰ˆï¼Œä¿è¯æ€§èƒ½ï¼‰
            const initThree = () => {
                const container = document.getElementById('canvas-bg');
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                container.appendChild(renderer.domElement);

                const geometry = new THREE.BufferGeometry();
                const count = 600;
                const pos = new Float32Array(count * 3);
                for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5)*15;
                geometry.setAttribute('position', new THREE.BufferAttribute(pos, 3));
                const material = new THREE.PointsMaterial({ size: 0.04, color: 0x764ba2, transparent: true, opacity: 0.5 });
                const mesh = new THREE.Points(geometry, material);
                scene.add(mesh);
                camera.position.z = 5;
                
                const animate = () => {
                    requestAnimationFrame(animate);
                    mesh.rotation.y += 0.0005;
                    renderer.render(scene, camera);
                };
                animate();
            };

            // ECharts å›¾è°±é€»è¾‘
            let chartInstance = null;
            const initChart = () => {
                const dom = document.getElementById('nexus-chart');
                if(!dom) return;
                chartInstance = echarts.init(dom);

                // åˆå§‹æ•°æ®ï¼šæˆ‘ + ç‰©å“èŠ‚ç‚¹ + æ¨èç”¨æˆ·èŠ‚ç‚¹
                const baseNodes = [
                    { id: '0', name: 'æˆ‘(Me)', symbolSize: 45, category: 0, fixed: true, x: 300, y: 300 },
                    // ç‰©å“
                    { id: 'item1', name: 'ä¸‰ä½“', symbolSize: 25, category: 1 },
                    { id: 'item2', name: 'Vue.jsè®¾è®¡', symbolSize: 25, category: 1 },
                    { id: 'item3', name: 'Pink Floyd', symbolSize: 25, category: 1 },
                    // ç”¨æˆ·
                    { id: '101', name: 'Alice', symbolSize: 35, category: 2 },
                    { id: '102', name: 'Bob', symbolSize: 35, category: 2 },
                    { id: '103', name: 'Carol', symbolSize: 35, category: 2 },
                ];

                const baseLinks = [
                    { source: '0', target: 'item1' },
                    { source: '0', target: 'item2' },
                    { source: '0', target: 'item3' },
                    // åˆå§‹æ‰€æœ‰æ¨èç”¨æˆ·éƒ½è¿æ¥åˆ°ä»–ä»¬å–œæ¬¢çš„ç‰©å“ï¼Œä½†ç½®ç°
                    { source: '101', target: 'item1' }, // Alice -> ä¸‰ä½“
                    { source: '102', target: 'item2' }, // Bob -> Vue
                    { source: '103', target: 'item3' }, // Carol -> Floyd
                ];

                renderGraph(baseNodes, baseLinks);
            };

            const renderGraph = (nodes, links) => {
                const option = {
                    color: ['#a29bfe', '#74b9ff', '#fab1a0'],
                    tooltip: {},
                    series: [{
                        type: 'graph',
                        layout: 'force',
                        data: nodes.map(n => ({
                            ...n,
                            // é«˜äº®é€»è¾‘ï¼šå¦‚æœé€‰ä¸­äº†æŸäººï¼Œæˆ–è€…èŠ‚ç‚¹æ˜¯"æˆ‘"æˆ–"å…±åŒç‰©å“"ï¼Œåˆ™é«˜äº®
                            itemStyle: isHighlighted(n) ? { opacity: 1, borderColor: '#fff', borderWidth: 2 } : { opacity: 0.3 }
                        })),
                        links: links.map(l => ({
                            ...l,
                            lineStyle: { 
                                opacity: isLinkHighlighted(l) ? 0.8 : 0.1,
                                width: isLinkHighlighted(l) ? 2 : 1,
                                color: '#fff' 
                            }
                        })),
                        categories: [{name:'æˆ‘'}, {name:'å…´è¶£ç‰©å“'}, {name:'æ¨èå¥½å‹'}],
                        roam: true,
                        label: { show: true, color: '#fff' },
                        force: { repulsion: 250, edgeLength: 90 }
                    }]
                };
                chartInstance.setOption(option);
            };

            // åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦é«˜äº®
            const isHighlighted = (node) => {
                if (!selectedUserId.value) return true; // æ²¡é€‰äººæ—¶å…¨é«˜äº®
                if (node.id === '0') return true; // æˆ‘æ°¸è¿œé«˜äº®
                if (node.id === selectedUserId.value) return true; // é€‰ä¸­çš„äººé«˜äº®
                // æ‰¾åˆ°é€‰ä¸­çš„äººå–œæ¬¢çš„ç‰©å“
                const targetUser = recommendedUsers.value.find(u => u.id === selectedUserId.value);
                if (targetUser && node.name.includes(targetUser.reason)) return true; // å…±åŒç‰©å“é«˜äº®
                return false;
            };

            // åˆ¤æ–­è¿çº¿æ˜¯å¦é«˜äº®
            const isLinkHighlighted = (link) => {
                if (!selectedUserId.value) return true;
                const targetId = selectedUserId.value;
                // é«˜äº®ï¼šæˆ‘->ç‰©å“ï¼Œç‰©å“->é€‰ä¸­çš„äºº
                // ç®€åŒ–åˆ¤æ–­ï¼šåªè¦è¿æ¥ç‚¹æ¶‰åŠé«˜äº®èŠ‚ç‚¹å³å¯
                return false; // è¿™é‡Œç®€å•å¤„ç†ï¼Œä¸»è¦é èŠ‚ç‚¹é€æ˜åº¦
            };

            // ç‚¹å‡»åˆ—è¡¨æŸç”¨æˆ·ï¼Œå›¾è°±èšç„¦
            const focusUser = (user) => {
                selectedUserId.value = user.id;
                // é‡æ–°æ¸²æŸ“å›¾è¡¨ä»¥åº”ç”¨é€æ˜åº¦å˜åŒ–
                const option = chartInstance.getOption();
                // ç®€å•è§¦å‘é‡ç»˜ï¼Œå®é™…ä¸Šåº”è¯¥æ›´æ–° data çš„ itemStyle
                initChart(); 
            };

            watch(activeTab, (val) => { 
                if(val === 2) {
                    nextTick(() => initChart());
                } else {
                    selectedUserId.value = null; // ç¦»å¼€é¡µé¢é‡ç½®
                }
            });

            onMounted(() => initThree());

            return { activeTab, searchVal, items, groups, recommendedUsers, selectedUserId, focusUser };
        }
    }).use(vant).mount('#app');
</script>
</body>
</html>